---
title: "Agent Flow"
sidebarTitle: "Agent Flow"
description: "Define complex workflow patterns in the PraisonAI Rust SDK"
icon: "diagram-project"
---

# Agent Flow

Agent Flow enables complex workflow patterns with Route, Parallel, Loop, and Repeat steps.

## Quick Start

```rust
use praisonai::{Agent, AgentFlow, Result};

#[tokio::main]
async fn main() -> Result<()> {
    let analyzer = Agent::new()
        .name("analyzer")
        .instructions("Analyze the input")
        .build()?;
    
    let summarizer = Agent::new()
        .name("summarizer")
        .instructions("Summarize the analysis")
        .build()?;
    
    let flow = AgentFlow::new()
        .agent(analyzer)
        .agent(summarizer);
    
    let result = flow.run("Analyze this document").await?;
    println!("{}", result);
    
    Ok(())
}
```

## Building Flows

Compose workflows with chained steps:

```rust
use praisonai::AgentFlow;

let flow = AgentFlow::new()
    .agent(agent1)          // Execute agent
    .step(FlowStep::...)    // Add custom step
    .agent(agent2);         // Chain another agent
```

## Flow Steps

### Agent Step

Execute a single agent:

```rust
use praisonai::workflows::FlowStep;
use std::sync::Arc;

let step = FlowStep::Agent(Arc::new(agent));

// Or use the helper method
let flow = AgentFlow::new().agent(analyzer);
```

### Route (Conditional Branching)

Route to different agents based on conditions:

```rust
use praisonai::workflows::{Route, FlowStep};
use std::sync::Arc;

let route = Route {
    condition: Box::new(|input| input.contains("urgent")),
    if_true: Arc::new(urgent_handler),
    if_false: Some(Arc::new(normal_handler)),
};

let flow = AgentFlow::new()
    .step(FlowStep::Route(route));
```

### Parallel (Concurrent Execution)

Run multiple agents simultaneously:

```rust
use praisonai::workflows::{Parallel, FlowStep};
use std::sync::Arc;

let parallel = Parallel {
    agents: vec![
        Arc::new(analyst_1),
        Arc::new(analyst_2),
        Arc::new(analyst_3),
    ],
};

let flow = AgentFlow::new()
    .step(FlowStep::Parallel(parallel));
```

### Loop (Iterate Over Items)

Process multiple items with the same agent:

```rust
use praisonai::workflows::{Loop, FlowStep};
use std::sync::Arc;

let loop_step = Loop {
    agent: Arc::new(processor),
    items: vec![
        "item1".to_string(),
        "item2".to_string(),
        "item3".to_string(),
    ],
};

let flow = AgentFlow::new()
    .step(FlowStep::Loop(loop_step));
```

### Repeat (Multiple Iterations)

Repeat an agent multiple times:

```rust
use praisonai::workflows::{Repeat, FlowStep};
use std::sync::Arc;

let repeat = Repeat {
    agent: Arc::new(refiner),
    times: 3,  // Run 3 times, each refining the previous output
};

let flow = AgentFlow::new()
    .step(FlowStep::Repeat(repeat));
```

## Running Flows

```rust
let flow = AgentFlow::new()
    .agent(step1)
    .agent(step2);

let result = flow.run("Initial input").await?;
```

## Example: Document Processing Pipeline

```rust
use praisonai::{Agent, AgentFlow};
use praisonai::workflows::{FlowStep, Route, Parallel, Loop};
use std::sync::Arc;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // Classification agent
    let classifier = Agent::new()
        .name("classifier")
        .instructions("Classify document type: 'technical' or 'business'")
        .build()?;
    
    // Technical document handler
    let tech_handler = Agent::new()
        .name("tech_handler")
        .instructions("Process technical documents with detailed analysis")
        .build()?;
    
    // Business document handler
    let biz_handler = Agent::new()
        .name("biz_handler")
        .instructions("Process business documents with executive summary")
        .build()?;
    
    // Build workflow
    let flow = AgentFlow::new()
        // First, classify the document
        .agent(classifier)
        // Then route based on classification
        .step(FlowStep::Route(Route {
            condition: Box::new(|input| input.to_lowercase().contains("technical")),
            if_true: Arc::new(tech_handler),
            if_false: Some(Arc::new(biz_handler)),
        }));
    
    let result = flow.run("Process this document...").await?;
    println!("{}", result);
    
    Ok(())
}
```

## Example: Multi-Perspective Analysis

```rust
use praisonai::{Agent, AgentFlow};
use praisonai::workflows::{FlowStep, Parallel};
use std::sync::Arc;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // Create analysts with different perspectives
    let financial = Agent::new()
        .name("financial_analyst")
        .instructions("Analyze from financial perspective")
        .build()?;
    
    let technical = Agent::new()
        .name("technical_analyst")
        .instructions("Analyze from technical perspective")
        .build()?;
    
    let market = Agent::new()
        .name("market_analyst")
        .instructions("Analyze from market perspective")
        .build()?;
    
    let synthesizer = Agent::new()
        .name("synthesizer")
        .instructions("Synthesize all analyses into a cohesive report")
        .build()?;
    
    // Run analyses in parallel, then synthesize
    let flow = AgentFlow::new()
        .step(FlowStep::Parallel(Parallel {
            agents: vec![
                Arc::new(financial),
                Arc::new(technical),
                Arc::new(market),
            ],
        }))
        .agent(synthesizer);
    
    let report = flow.run("Analyze this business proposal").await?;
    println!("{}", report);
    
    Ok(())
}
```

## Example: Iterative Refinement

```rust
use praisonai::{Agent, AgentFlow};
use praisonai::workflows::{FlowStep, Repeat};
use std::sync::Arc;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let drafter = Agent::new()
        .name("drafter")
        .instructions("Write initial draft")
        .build()?;
    
    let refiner = Agent::new()
        .name("refiner")
        .instructions("Improve the writing: fix errors, enhance clarity")
        .build()?;
    
    // Draft once, then refine 3 times
    let flow = AgentFlow::new()
        .agent(drafter)
        .step(FlowStep::Repeat(Repeat {
            agent: Arc::new(refiner),
            times: 3,
        }));
    
    let polished = flow.run("Write about machine learning").await?;
    println!("{}", polished);
    
    Ok(())
}
```

## Related

<CardGroup cols={2}>
  <Card title="Agent Team" icon="users" href="/docs/rust/agent-team">
    Simple multi-agent coordination
  </Card>
  <Card title="Handoffs" icon="arrow-right-arrow-left" href="/docs/rust/handoffs">
    Dynamic agent transfers
  </Card>
  <Card title="Agent" icon="robot" href="/docs/rust/agent">
    Individual agent API
  </Card>
  <Card title="Process" icon="list-check" href="/docs/concepts/process">
    Process types explained
  </Card>
</CardGroup>
