---
title: "Policy"
sidebarTitle: "Policy"
description: "Policy engine for agent behavior control in the PraisonAI Rust SDK"
icon: "shield-check"
---

# Policy

The Policy module provides a policy engine for controlling agent behavior, including content filtering, redaction, and approval workflows.

## Quick Start

```rust
use praisonai::policy::{PolicyEngine, PolicyRule, PolicyAction};

let mut engine = PolicyEngine::new();

// Add rules
engine.add_rule(
    PolicyRule::new("no-pii")
        .keyword("social security")
        .action(PolicyAction::Block)
);

// Check content
let result = engine.check("My SSN is 123-45-6789");
if !result.allowed {
    println!("Blocked by: {}", result.triggered_rule.unwrap());
}
```

## PolicyAction

Actions taken when rules match:

| Action | Description |
|--------|-------------|
| `Allow` | Allow the action |
| `Block` | Block completely |
| `Warn` | Warn but allow |
| `RequireApproval` | Require user approval |
| `Redact` | Redact matched content |
| `Log` | Log and allow |

## PolicyResult

Result of a policy check:

```rust
use praisonai::policy::PolicyResult;

// Passing result
let pass = PolicyResult::pass();
println!("Allowed: {}", pass.allowed);  // true

// Blocking result
let block = PolicyResult::block("no-pii", "Contains PII");
println!("Allowed: {}", block.allowed);  // false
println!("Rule: {:?}", block.triggered_rule);

// Warning result
let warn = PolicyResult::warn("sensitive", "Contains sensitive info");
println!("Allowed: {}", warn.allowed);  // true
println!("Warning: {:?}", warn.message);

// Redaction result
let redact = PolicyResult::redact("pii-filter", "Content with [REDACTED]");
println!("Modified: {:?}", redact.modified_content);
```

## PolicyRule

Define policy rules:

```rust
use praisonai::policy::{PolicyRule, PolicyAction};

let rule = PolicyRule::new("credit-card")
    .description("Block credit card numbers")
    .pattern(r"\d{4}[- ]?\d{4}[- ]?\d{4}[- ]?\d{4}")
    .action(PolicyAction::Redact)
    .replacement("[CARD REDACTED]")
    .priority(10);

// Check if content matches
let content = "Card: 4111-1111-1111-1111";
if rule.matches(content) {
    println!("Match found");
    
    // Apply the rule
    let result = rule.apply(content);
    println!("Result: {:?}", result);
    
    // Redact
    let redacted = rule.redact_content(content);
    println!("Redacted: {}", redacted);
}
```

### Rule Configuration

| Method | Description |
|--------|-------------|
| `description(d)` | Set description |
| `pattern(p)` | Regex pattern |
| `keyword(k)` | Add keyword |
| `action(a)` | Set action |
| `priority(p)` | Set priority |
| `replacement(r)` | Redaction text |
| `enable()` | Enable rule |
| `disable()` | Disable rule |

## PolicyEngine

Engine for evaluating policies:

```rust
use praisonai::policy::{PolicyEngine, PolicyRule, PolicyAction};

let mut engine = PolicyEngine::new();

// Add rules
engine.add_rule(
    PolicyRule::new("profanity")
        .keyword("badword")
        .action(PolicyAction::Block)
);

engine.add_rule(
    PolicyRule::new("email")
        .pattern(r"[\w.-]+@[\w.-]+\.\w+")
        .action(PolicyAction::Redact)
        .replacement("[EMAIL]")
);

// Enable/disable engine
engine.enable();
engine.disable();
engine.enable();

// Check content
let result = engine.check("Contact: user@example.com");
println!("Allowed: {}", result.allowed);

// Check and redact
let (result, redacted) = engine.check_and_redact("Email: test@test.com");
println!("Redacted: {}", redacted);  // "Email: [EMAIL]"

// Rule management
println!("Rules: {}", engine.rule_count());
engine.clear();
```

### Engine Methods

| Method | Description |
|--------|-------------|
| `add_rule(rule)` | Add a rule |
| `remove_rule(name)` | Remove by name |
| `get_rule(name)` | Get rule |
| `check(content)` | Check content |
| `check_and_redact(content)` | Check and redact |
| `rule_count()` | Count rules |
| `clear()` | Clear all rules |

## Built-in Rule Presets

```rust
use praisonai::policy::PolicyPresets;

let mut engine = PolicyEngine::new();

// Add common rule sets
engine.add_rules(PolicyPresets::pii());      // PII detection
engine.add_rules(PolicyPresets::security()); // Security patterns
engine.add_rules(PolicyPresets::profanity()); // Profanity filter
```

## Example: Content Moderation

```rust
use praisonai::{Agent, Result};
use praisonai::policy::{PolicyEngine, PolicyRule, PolicyAction};

#[tokio::main]
async fn main() -> Result<()> {
    // Setup policy engine
    let mut engine = PolicyEngine::new();
    
    // Block PII
    engine.add_rule(
        PolicyRule::new("ssn")
            .pattern(r"\d{3}-\d{2}-\d{4}")
            .action(PolicyAction::Redact)
            .replacement("[SSN REDACTED]")
    );
    
    // Block sensitive topics
    engine.add_rule(
        PolicyRule::new("restricted")
            .keyword("confidential")
            .keyword("top secret")
            .action(PolicyAction::Block)
    );
    
    // Create agent with policy
    let agent = Agent::new()
        .name("moderated")
        .instructions("You are a helpful assistant")
        .policy_engine(engine)
        .build()?;
    
    // Content will be filtered
    let result = agent.chat("My SSN is 123-45-6789").await?;
    println!("{}", result);
    
    Ok(())
}
```

## Related

<CardGroup cols={2}>
  <Card title="Guardrails" icon="shield" href="/docs/rust/guardrails">
    Input/output guards
  </Card>
  <Card title="Agent" icon="robot" href="/docs/rust/agent">
    Agent API
  </Card>
  <Card title="Security" icon="lock" href="/docs/rust/security">
    Security features
  </Card>
  <Card title="Approval" icon="check-double" href="/docs/rust/approval">
    Approval workflows
  </Card>
</CardGroup>
