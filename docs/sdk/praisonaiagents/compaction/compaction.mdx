---
title: "Compaction"
description: "Auto context compaction for long conversations"
icon: "compress"
---

# Compaction Module

The compaction module provides automatic context management for long conversations, including message summarization and intelligent pruning.

## Installation

```bash
pip install praisonaiagents
```

## Features

- **Message summarization**
- **Context window management**
- **Token counting and limits**
- **Intelligent message pruning**

## Quick Start

```python
from praisonaiagents.compaction import ContextCompactor

# Create a compactor
compactor = ContextCompactor(
    max_tokens=8000,
    strategy="summarize"
)

# Compact messages when needed
compacted = compactor.compact(messages)
```

## Classes

### ContextCompactor

Main class for compacting conversation context.

```python
from praisonaiagents.compaction import ContextCompactor

compactor = ContextCompactor(
    max_tokens=8000,
    strategy="summarize"
)
```

#### Constructor

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `max_tokens` | `int` | `8000` | Maximum context tokens |
| `strategy` | `str` | `"summarize"` | Compaction strategy |
| `preserve_recent` | `int` | `5` | Recent messages to preserve |

#### Methods

| Method | Description |
|--------|-------------|
| `compact(messages)` | Compact messages to fit budget |
| `should_compact(messages)` | Check if compaction needed |
| `get_token_count(messages)` | Count tokens in messages |

### CompactionConfig

Configuration for compaction behavior.

```python
from praisonaiagents.compaction import CompactionConfig

config = CompactionConfig(
    max_tokens=8000,
    strategy="summarize",
    preserve_system=True,
    preserve_recent=5
)
```

#### Attributes

| Attribute | Type | Description |
|-----------|------|-------------|
| `max_tokens` | `int` | Maximum context tokens |
| `strategy` | `str` | Compaction strategy |
| `preserve_system` | `bool` | Keep system messages |
| `preserve_recent` | `int` | Recent messages to keep |

### CompactionStrategy

Available compaction strategies.

```python
from praisonaiagents.compaction import CompactionStrategy

CompactionStrategy.SUMMARIZE  # Summarize old messages
CompactionStrategy.TRUNCATE   # Remove oldest messages
CompactionStrategy.SLIDING    # Sliding window approach
```

### CompactionResult

Result of a compaction operation.

```python
from praisonaiagents.compaction import CompactionResult

result = compactor.compact(messages)
print(result.original_tokens)
print(result.compacted_tokens)
print(result.messages)
```

#### Attributes

| Attribute | Type | Description |
|-----------|------|-------------|
| `messages` | `list` | Compacted messages |
| `original_tokens` | `int` | Original token count |
| `compacted_tokens` | `int` | Final token count |
| `summary` | `str` | Summary of removed content |

## Usage Examples

### Basic Compaction

```python
from praisonaiagents.compaction import ContextCompactor

compactor = ContextCompactor(max_tokens=4000)

messages = [
    {"role": "system", "content": "You are helpful."},
    {"role": "user", "content": "Long conversation..."},
    # ... many more messages
]

if compactor.should_compact(messages):
    result = compactor.compact(messages)
    messages = result.messages
```

### With Agent

```python
from praisonaiagents import Agent
from praisonaiagents.compaction import ContextCompactor

compactor = ContextCompactor(
    max_tokens=8000,
    strategy="summarize"
)

agent = Agent(
    name="Assistant",
    context_compactor=compactor
)

# Agent automatically compacts context when needed
```

### Summarize Strategy

```python
from praisonaiagents.compaction import ContextCompactor

compactor = ContextCompactor(
    max_tokens=4000,
    strategy="summarize",
    preserve_recent=10  # Keep last 10 messages
)

# Old messages are summarized into a single message
result = compactor.compact(long_conversation)
```

### Sliding Window

```python
from praisonaiagents.compaction import ContextCompactor

compactor = ContextCompactor(
    max_tokens=4000,
    strategy="sliding"
)

# Keeps most recent messages within token budget
```

## Best Practices

1. **Set appropriate limits** - Balance context vs. cost
2. **Preserve important messages** - Keep system prompts and recent context
3. **Use summarization** - Better than truncation for continuity
4. **Monitor token usage** - Track compaction frequency

## Related

- [Agent](/docs/sdk/praisonaiagents/agent/agent) - Agent configuration
- [Session](/docs/sdk/praisonaiagents/session) - Session management
- [Memory](/docs/sdk/praisonaiagents/memory/memory) - Long-term memory
