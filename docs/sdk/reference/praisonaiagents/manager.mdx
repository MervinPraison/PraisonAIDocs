---
title: "manager"
description: "Context Manager Facade for PraisonAI Agents."
icon: "users-cog"
---

# manager

<Badge color="blue">Core SDK</Badge>

Context Manager Facade for PraisonAI Agents.

Provides a unified interface for context management:
- Budgeting and allocation
- Token estimation with validation
- Composition within limits
- Optimization with benefit checking
- Monitoring with snapshot hooks
- Multi-agent orchestration support
- Optimization history tracking

This is the main entry point for context management in both SDK and CLI.

## Import

```python
from praisonaiagents import manager
```

## Classes

### SessionDeduplicationCache

Thread-safe session-level content deduplication cache.

Tracks content hashes across all agents in a workflow session
to prevent duplicate content from being sent to LLM.

<Accordion title="Constructor Parameters">

| Parameter | Type | Required | Default |
|-----------|------|----------|---------|
| `max_size` | `int` | No | `1000` |

</Accordion>

<Accordion title="Methods">

- **check_and_add**(`content_hash: str, agent_name: str, tokens: int`) → `bool`
  Check if content hash exists and add if new.
- **get_stats**(``) → `Dict[str, int]`
  Get deduplication statistics.
- **clear**(``) → `None`
  Clear the cache.

</Accordion>

### EstimationMode

*Extends: str, Enum*

Token estimation modes.

### ContextShareMode

*Extends: str, Enum*

How context is shared between agents.

### ToolShareMode

*Extends: str, Enum*

How tools are shared between agents.

### OptimizationEventType

*Extends: str, Enum*

Types of optimization events.

### ContextPolicy

Policy for context sharing during agent handoffs.

Controls how context is passed between agents in multi-agent scenarios.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `share` | `bool` |
| `share_mode` | `ContextShareMode` |
| `max_tokens` | `int` |
| `tools_share` | `ToolShareMode` |
| `preserve_system` | `bool` |
| `preserve_recent_turns` | `int` |

</Accordion>

<Accordion title="Methods">

- **to_dict**(``) → `Dict[str, Any]`

</Accordion>

### OptimizationEvent

Record of an optimization event.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `timestamp` | `str` |
| `event_type` | `OptimizationEventType` |
| `strategy` | `Optional[str]` |
| `tokens_before` | `int` |
| `tokens_after` | `int` |
| `tokens_saved` | `int` |
| `messages_affected` | `int` |
| `details` | `Dict[str, Any]` |

</Accordion>

<Accordion title="Methods">

- **to_dict**(``) → `Dict[str, Any]`

</Accordion>

### EstimationMetrics

Metrics for token estimation accuracy.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `heuristic_estimate` | `int` |
| `accurate_estimate` | `int` |
| `error_pct` | `float` |
| `estimator_used` | `EstimationMode` |

</Accordion>

<Accordion title="Methods">

- **to_dict**(``) → `Dict[str, Any]`

</Accordion>

### PerToolBudget

Per-tool token budget configuration.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `tool_name` | `str` |
| `max_output_tokens` | `int` |
| `protected` | `bool` |

</Accordion>

<Accordion title="Methods">

- **to_dict**(``) → `Dict[str, Any]`

</Accordion>

### SnapshotHookData

Data captured at LLM call boundary for exact snapshot.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `timestamp` | `str` |
| `messages` | `List[Dict]` |
| `tools` | `List[Dict]` |
| `message_hash` | `str` |
| `tools_hash` | `str` |
| `ledger` | `Optional` |
| `budget` | `Optional` |

</Accordion>

<Accordion title="Methods">

- **to_dict**(``) → `Dict[str, Any]`

</Accordion>

### ManagerConfig

Complete configuration for ContextManager.

Consolidates all context management settings with proper precedence.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `auto_compact` | `bool` |
| `compact_threshold` | `float` |
| `strategy` | `OptimizerStrategy` |
| `compression_min_gain_pct` | `float` |
| `compression_max_attempts` | `int` |
| `output_reserve` | `int` |
| `history_ratio` | `float` |
| `default_tool_output_max` | `int` |
| `tool_budgets` | `Dict` |
| `protected_tools` | `List[str]` |
| `llm_summarize` | `bool` |
| `smart_tool_summarize` | `bool` |
| `tool_summarize_limits` | `Dict[str, int]` |
| `estimation_mode` | `EstimationMode` |
| `log_estimation_mismatch` | `bool` |
| `mismatch_threshold_pct` | `float` |
| `monitor_enabled` | `bool` |
| `monitor_path` | `str` |
| `monitor_format` | `Literal` |
| `monitor_frequency` | `Literal` |
| `monitor_write_mode` | `Literal` |
| `redact_sensitive` | `bool` |
| `snapshot_timing` | `Literal` |
| `allow_absolute_paths` | `bool` |
| `prune_after_tokens` | `int` |
| `keep_recent_turns` | `int` |
| `source` | `str` |

</Accordion>

<Accordion title="Methods">

- **to_dict**(``) → `Dict[str, Any]`
- **merge**(``) → `ManagerConfig`
  Create new config with overrides applied.

</Accordion>

### ContextManager

Unified facade for context management.

Orchestrates budgeting, composition, optimization, and monitoring.
Provides hooks for exact LLM boundary snapshots.
Tracks optimization history for debugging.

<Accordion title="Constructor Parameters">

| Parameter | Type | Required | Default |
|-----------|------|----------|---------|
| `model` | `str` | No | `'gpt-4o-mini'` |
| `config` | `Optional` | No | `None` |
| `session_id` | `str` | No | `''` |
| `agent_name` | `str` | No | `''` |
| `session_cache` | `Optional` | No | `None` |
| `llm_summarize_fn` | `Optional` | No | `None` |

</Accordion>

<Accordion title="Methods">

- **process**(`messages`) → `Dict[str, Any]`
  Process messages through the context pipeline.
- **capture_llm_boundary**(`messages`) → `SnapshotHookData`
  Capture exact state at LLM call boundary.
- **register_snapshot_callback**(`callback`) → `None`
  Register a callback for LLM boundary snapshots.
- **get_last_snapshot_hook**(``) → `Optional`
  Get the last LLM boundary snapshot.
- **estimate_tokens**(`text: str, validate: bool`) → `Tuple`
  Estimate tokens with optional validation.
- **get_tool_budget**(`tool_name: str`) → `int`
  Get token budget for a specific tool.
- **set_tool_budget**(`tool_name: str, max_tokens: int, protected: bool`) → `None`
  Set token budget for a specific tool.
- **truncate_tool_output**(`tool_name: str, output: str`) → `str`
  Truncate tool output according to its budget.
- **get_history**(``) → `List[Dict]`
  Get optimization history.
- **get_stats**(``) → `Dict[str, Any]`
  Get current context statistics.
- **emergency_truncate**(`messages`) → `List[Dict]`
  Emergency truncation when optimization isn't enough.
- **get_resolved_config**(``) → `Dict[str, Any]`
  Get the fully resolved configuration with source info.
- **reset**(``) → `None`
  Reset manager state.

</Accordion>

### MultiAgentContextManager

Context manager for multi-agent orchestration.

Provides per-agent isolation with controlled sharing policies.

<Accordion title="Constructor Parameters">

| Parameter | Type | Required | Default |
|-----------|------|----------|---------|
| `config` | `Optional` | No | `None` |
| `default_policy` | `Optional` | No | `None` |
| `session_cache` | `Optional` | No | `None` |

</Accordion>

<Accordion title="Methods">

- **get_agent_manager**(`agent_id: str, model: str`) → `ContextManager`
  Get or create context manager for an agent.
- **get_session_cache**(``) → `SessionDeduplicationCache`
  Get the session deduplication cache.
- **set_agent_policy**(`agent_id: str, policy: ContextPolicy`) → `None`
  Set context policy for an agent.
- **get_agent_policy**(`agent_id: str`) → `ContextPolicy`
  Get context policy for an agent.
- **prepare_handoff**(`from_agent`) → `List[Dict]`
  Prepare context for handoff between agents.
- **get_combined_stats**(``) → `Dict[str, Any]`
  Get combined statistics across all agents.

</Accordion>

## Functions

### deduplicate_topics()

Programmatic deduplication of topics/items before agent processing.

This helps prevent duplicate content from being passed to downstream agents,
reducing token waste and improving quality.

```python
def deduplicate_topics(topics: list, key: str, similarity_threshold: float) -> list
```

<Expandable title="Parameters">

- **topics** (`list`)
- **key** (`str`)
- **similarity_threshold** (`float`)

</Expandable>

### create_context_manager()

Create a context manager with proper config precedence.

Precedence: CLI > ENV > config_file > defaults

```python
def create_context_manager(model) -> ContextManager
```

<Expandable title="Parameters">

- **model** (`str`)
- **session_id** (`str`)
- **agent_name** (`str`)
- **config_file** (`Optional[str]`)
- **cli_overrides** (`Optional[Dict]`)

</Expandable>
