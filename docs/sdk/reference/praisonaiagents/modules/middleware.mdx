---
title: "middleware"
description: "Middleware System for PraisonAI Agents."
icon: "file-code"
---

# praisonaiagents.hooks.middleware

<Badge color="blue">Core SDK</Badge>

Middleware System for PraisonAI Agents.

Provides wrap_model_call and wrap_tool_call patterns for intercepting
and modifying agent behavior at model/tool call boundaries.

Zero Performance Impact:
- All middleware is optional
- Empty middleware chain is O(1) fast path
- No overhead when middleware not registered

Usage:
    from praisonaiagents.hooks import before_model, wrap_model_call, wrap_tool_call
    
    @before_model
    def add_context(request):
        request.messages.append(&#123;"role": "system", "content": "Extra"&#125;)
        return request
    
    @wrap_model_call
    def retry_on_error(request, call_next):
        for _ in range(3):
            try:
                return call_next(request)
            except Exception:
                pass
        raise RuntimeError("All retries failed")
    
    agent = Agent(name="Test", hooks=[add_context, retry_on_error])

## Overview
This module provides components for middleware.

## Classes

**[Dedicated Page: InvocationContext](../classes/InvocationContext)**

### InvocationContext

Context passed through middleware chain.

Contains identifiers for multi-agent safety and optional metadata.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `agent_id` | `str` |
| `run_id` | `str` |
| `session_id` | `str` |
| `tool_name` | `Optional` |
| `model_name` | `Optional` |
| `metadata` | `Dict` |
</Accordion>


**[Dedicated Page: ModelRequest](../classes/ModelRequest)**

### ModelRequest

Request data for model calls.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `messages` | `List` |
| `model` | `str` |
| `temperature` | `float` |
| `context` | `Optional` |
| `tools` | `Optional` |
| `extra` | `Dict` |
</Accordion>


**[Dedicated Page: ModelResponse](../classes/ModelResponse)**

### ModelResponse

Response data from model calls.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `content` | `str` |
| `model` | `str` |
| `usage` | `Optional` |
| `context` | `Optional` |
| `tool_calls` | `Optional` |
| `extra` | `Dict` |
</Accordion>


**[Dedicated Page: ToolRequest](../classes/ToolRequest)**

### ToolRequest

Request data for tool calls.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `tool_name` | `str` |
| `arguments` | `Dict` |
| `context` | `Optional` |
| `extra` | `Dict` |
</Accordion>


**[Dedicated Page: ToolResponse](../classes/ToolResponse)**

### ToolResponse

Response data from tool calls.

<Accordion title="Properties">

| Property | Type |
|----------|------|
| `tool_name` | `str` |
| `result` | `Any` |
| `error` | `Optional` |
| `context` | `Optional` |
| `extra` | `Dict` |
</Accordion>


**[Dedicated Page: MiddlewareChain](../classes/MiddlewareChain)**

### MiddlewareChain

Synchronous middleware chain executor.

Composes middleware functions in registration order.
First registered middleware wraps all subsequent ones.

<Accordion title="Constructor Parameters">

| Parameter | Type | Required | Default |
|-----------|------|----------|---------|
| `middlewares` | `Optional` | No | `None` |
</Accordion>

<Accordion title="Methods">
- **execute**(`request: Any, final_handler: Callable`) → `Any`
  Execute the middleware chain with a final handler.
</Accordion>


**[Dedicated Page: AsyncMiddlewareChain](../classes/AsyncMiddlewareChain)**

### AsyncMiddlewareChain

Asynchronous middleware chain executor.

Same as MiddlewareChain but for async middleware and handlers.

<Accordion title="Constructor Parameters">

| Parameter | Type | Required | Default |
|-----------|------|----------|---------|
| `middlewares` | `Optional` | No | `None` |
</Accordion>

<Accordion title="Methods">
- **async execute**(`request: Any, final_handler: Callable`) → `Any`
  Execute the async middleware chain.
</Accordion>


**[Dedicated Page: MiddlewareManager](../classes/MiddlewareManager)**

### MiddlewareManager

Manages middleware for an agent.

Provides methods to execute before/after hooks and middleware chains
for both model and tool calls.

<Accordion title="Constructor Parameters">

| Parameter | Type | Required | Default |
|-----------|------|----------|---------|
| `hooks` | `Optional` | No | `None` |
</Accordion>

<Accordion title="Methods">
- **has_model_hooks**(``) → `bool`
  Check if any model hooks are registered.
- **has_tool_hooks**(``) → `bool`
  Check if any tool hooks are registered.
- **run_before_model**(`request: ModelRequest`) → `ModelRequest`
  Run all before_model hooks.
- **run_after_model**(`response: ModelResponse`) → `ModelResponse`
  Run all after_model hooks (in reverse order).
- **run_before_tool**(`request: ToolRequest`) → `ToolRequest`
  Run all before_tool hooks.
- **run_after_tool**(`response: ToolResponse`) → `ToolResponse`
  Run all after_tool hooks (in reverse order).
- **execute_model_call**(`request: ModelRequest, model_fn: Callable`) → `ModelResponse`
  Execute a model call with all hooks and middleware.

Order:
1. before_model hook
- **execute_tool_call**(`request: ToolRequest, tool_fn: Callable`) → `ToolResponse`
  Execute a tool call with all hooks and middleware.

Order:
1. before_tool hooks 
</Accordion>


## Functions

**[Dedicated Page: before_model()](../functions/before_model)**

### before_model()

Decorator to mark a function as a before_model hook.

The function receives a ModelRequest and should return a (possibly modified) ModelRequest.

```python
def before_model(func: BeforeModelFn) -> BeforeModelFn
```

<Expandable title="Parameters">
- **func** (`BeforeModelFn`)
</Expandable>


**[Dedicated Page: after_model()](../functions/after_model)**

### after_model()

Decorator to mark a function as an after_model hook.

The function receives a ModelResponse and should return a (possibly modified) ModelResponse.

```python
def after_model(func: AfterModelFn) -> AfterModelFn
```

<Expandable title="Parameters">
- **func** (`AfterModelFn`)
</Expandable>


**[Dedicated Page: wrap_model_call()](../functions/wrap_model_call)**

### wrap_model_call()

Decorator to mark a function as a wrap_model_call middleware.

The function receives (request, call_next) and should call call_next(request)
to continue the chain, or return early to short-circuit.

```python
def wrap_model_call(func: WrapModelCallFn) -> WrapModelCallFn
```

<Expandable title="Parameters">
- **func** (`WrapModelCallFn`)
</Expandable>


**[Dedicated Page: before_tool()](../functions/before_tool)**

### before_tool()

Decorator to mark a function as a before_tool hook.

The function receives a ToolRequest and should return a (possibly modified) ToolRequest.

```python
def before_tool(func: BeforeToolFn) -> BeforeToolFn
```

<Expandable title="Parameters">
- **func** (`BeforeToolFn`)
</Expandable>


**[Dedicated Page: after_tool()](../functions/after_tool)**

### after_tool()

Decorator to mark a function as an after_tool hook.

The function receives a ToolResponse and should return a (possibly modified) ToolResponse.

```python
def after_tool(func: AfterToolFn) -> AfterToolFn
```

<Expandable title="Parameters">
- **func** (`AfterToolFn`)
</Expandable>


**[Dedicated Page: wrap_tool_call()](../functions/wrap_tool_call)**

### wrap_tool_call()

Decorator to mark a function as a wrap_tool_call middleware.

The function receives (request, call_next) and should call call_next(request)
to continue the chain, or return early to short-circuit.

```python
def wrap_tool_call(func: WrapToolCallFn) -> WrapToolCallFn
```

<Expandable title="Parameters">
- **func** (`WrapToolCallFn`)
</Expandable>


**[Dedicated Page: get_hook_type()](../functions/get_hook_type)**

### get_hook_type()

Get the hook type of a decorated function.

```python
def get_hook_type(func: Callable) -> Optional[str]
```

<Expandable title="Parameters">
- **func** (`Callable`)
</Expandable>


**[Dedicated Page: is_middleware()](../functions/is_middleware)**

### is_middleware()

Check if a function is a middleware (wrap_* type).

```python
def is_middleware(func: Callable) -> bool
```

<Expandable title="Parameters">
- **func** (`Callable`)
</Expandable>


**[Dedicated Page: categorize_hooks()](../functions/categorize_hooks)**

### categorize_hooks()

Categorize hooks by their type.

```python
def categorize_hooks(hooks: List[Callable]) -> Dict[str, List[Callable]]
```

<Expandable title="Parameters">
- **hooks** (`List`)
</Expandable>


## Constants

| Name | Value |
|------|-------|
| `T` | `TypeVar('T')` |
