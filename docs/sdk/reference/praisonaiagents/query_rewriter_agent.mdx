---
title: "query_rewriter_agent"
description: "Query Rewriter Agent Module"
icon: "pencil"
---

# query_rewriter_agent

<Badge color="blue">Core SDK</Badge>

## Overview

```mermaid
graph TD
    Agent["Agent"]:::agent
    classDef agent fill:#8B0000,stroke:#8B0000,color:#fff
```

Query Rewriter Agent Module

This module provides the QueryRewriterAgent class for transforming user queries
to improve retrieval quality in RAG applications.

Supported Rewriting Strategies:
- **BASIC**: Simple rephrasing for clarity and keyword optimization
- **HYDE**: Hypothetical Document Embeddings - generates a hypothetical answer
- **STEP_BACK**: Generates higher-level concept questions for complex queries
- **SUB_QUERIES**: Decomposes multi-part questions into focused sub-queries
- **MULTI_QUERY**: Generates multiple paraphrased versions for ensemble retrieval
- **CONTEXTUAL**: Uses conversation history to resolve references and context

Example:
    from praisonaiagents import QueryRewriterAgent, RewriteStrategy
    
    agent = QueryRewriterAgent()
    
    # Basic rewriting
    result = agent.rewrite("AI trends")
    print(result.rewritten_queries)
    
    # HyDE for better semantic matching
    result = agent.rewrite("What is quantum computing?", strategy=RewriteStrategy.HYDE)
    print(result.hypothetical_document)
    
    # Contextual with chat history
    chat_history = [
        &#123;"role": "user", "content": "Tell me about Python"&#125;,
        &#123;"role": "assistant", "content": "Python is a programming language..."&#125;
    ]
    result = agent.rewrite("What about its performance?", chat_history=chat_history)
    
    # With search tools for context-aware rewriting
    from praisonaiagents.tools import internet_search
    agent = QueryRewriterAgent(tools=[internet_search])
    result = agent.rewrite("latest AI developments")  # Searches first, then rewrites

## Import

```python
from praisonaiagents import query_rewriter_agent
```

## Classes

### RewriteStrategy

*Extends: Enum*

Enumeration of available query rewriting strategies.

### RewriteResult

Result of a query rewriting operation.

<Expandable title="Properties">

<ResponseField name="original_query" type="str">
</ResponseField>
<ResponseField name="rewritten_queries" type="List">
</ResponseField>
<ResponseField name="strategy_used" type="RewriteStrategy">
</ResponseField>
<ResponseField name="hypothetical_document" type="Optional">
</ResponseField>
<ResponseField name="step_back_question" type="Optional">
</ResponseField>
<ResponseField name="sub_queries" type="Optional">
</ResponseField>
<ResponseField name="metadata" type="Dict">
</ResponseField>

</Expandable>

#### Methods

##### primary_query() -> str

Returns the primary rewritten query.

---
##### all_queries() -> List

Returns all queries including original and rewritten.

---

### QueryRewriterAgent

Agent for rewriting queries to improve retrieval quality in RAG applications.

This agent transforms user queries using various strategies to bridge the gap
between how users ask questions and how information is stored in knowledge bases.

Attributes:
    name: Name of the agent
    model: LLM model to use for rewriting (alias for llm=)
    max_queries: Maximum number of queries to generate for multi-query strategy
    abbreviations: Dictionary of common abbreviations to expand
    
Example:
    agent = QueryRewriterAgent(model="gpt-4o-mini")
    result = agent.rewrite("ML best practices", strategy=RewriteStrategy.MULTI_QUERY)
    for query in result.rewritten_queries:
        print(query)

<Expandable title="Constructor Parameters">

<ParamField query="name" type="str">
   (default: `QueryRewriterAgent`)
</ParamField>
<ParamField query="model" type="str">
   (default: `'gpt-4o-mini'`)
</ParamField>
<ParamField query="instructions" type="Optional">
   (default: `None`)
</ParamField>
<ParamField query="verbose" type="bool">
   (default: `False`)
</ParamField>
<ParamField query="max_queries" type="int">
   (default: `5`)
</ParamField>
<ParamField query="abbreviations" type="Optional">
   (default: `None`)
</ParamField>
<ParamField query="temperature" type="float">
   (default: `0.3`)
</ParamField>
<ParamField query="max_tokens" type="int">
   (default: `500`)
</ParamField>
<ParamField query="tools" type="Optional">
   (default: `None`)
</ParamField>

</Expandable>

#### Methods

##### agent() -> Any

Lazy initialization of internal Agent.

---
##### rewrite(query: str, strategy: RewriteStrategy, chat_history: Optional) -> RewriteResult

Rewrite a query using the specified strategy.

All operations go through an internal Agent which automatically handles
tool calling when tools are provided. The agent decides when to use tools
based on the query context.

Args:
    query: The original user query
    strategy: Rewriting strategy to use
    chat_history: Previous conversation messages for contextual rewriting
    context: Additional context about the knowledge base
    num_queries: Number of queries for multi-query strategy
    
Returns:
    RewriteResult containing rewritten queries

---
##### rewrite_basic(query: str) -> RewriteResult

Convenience method for basic rewriting.

---
##### rewrite_hyde(query: str) -> RewriteResult

Convenience method for HyDE rewriting.

---
##### rewrite_step_back(query: str) -> RewriteResult

Convenience method for step-back rewriting.

---
##### rewrite_sub_queries(query: str) -> RewriteResult

Convenience method for sub-query decomposition.

---
##### rewrite_multi_query(query: str, num_queries: int) -> RewriteResult

Convenience method for multi-query generation.

---
##### rewrite_contextual(query: str, chat_history: List) -> RewriteResult

Convenience method for contextual rewriting.

---
##### add_abbreviation(abbrev: str, expansion: str) -> None

Add a custom abbreviation expansion.

---
##### add_abbreviations(abbreviations: Dict) -> None

Add multiple custom abbreviation expansions.

---

