---
title: "PostgreSQL Integration"
description: "PostgreSQL for persistent session and message storage"
icon: "elephant"
---

# PostgreSQL Integration

PraisonAI TypeScript provides PostgreSQL adapters for persistent storage of sessions, messages, and agent runs.

## Quick Start

```typescript
import { createNeonPostgres, createMemoryPostgres, createPostgresSessionStorage } from 'praisonai';

// Neon PostgreSQL (serverless)
const db = createNeonPostgres({
  connectionString: process.env.DATABASE_URL
});

// In-memory PostgreSQL (for testing)
const memoryDb = createMemoryPostgres();

// Session storage
const sessions = createPostgresSessionStorage(db);
```

## Basic Operations

```typescript
// Connect
await db.connect();

// Query
const users = await db.query<{ id: string; name: string }>(
  'SELECT * FROM users WHERE role = $1',
  ['admin']
);

// Execute
const result = await db.execute(
  'INSERT INTO users (id, name) VALUES ($1, $2)',
  ['user-123', 'John']
);
console.log(`Inserted ${result.rowCount} rows`);

// Disconnect
await db.disconnect();
```

## Session Storage

```typescript
import { createNeonPostgres, createPostgresSessionStorage } from 'praisonai';

const db = createNeonPostgres({ connectionString: process.env.DATABASE_URL });
const sessions = createPostgresSessionStorage(db, 'agent_sessions');

// Initialize tables
await sessions.init();

// Create session
await sessions.createSession('session-123', {
  userId: 'user-456',
  agentId: 'assistant',
  startedAt: new Date().toISOString()
});

// Get session
const session = await sessions.getSession('session-123');

// Update session
await sessions.updateSession('session-123', {
  ...session,
  lastActivity: new Date().toISOString()
});

// Add message
await sessions.addMessage('session-123', {
  id: 'msg-1',
  role: 'user',
  content: 'Hello!'
});

await sessions.addMessage('session-123', {
  id: 'msg-2',
  role: 'assistant',
  content: 'Hi! How can I help?'
});

// Get messages
const messages = await sessions.getMessages('session-123');

// Delete session
await sessions.deleteSession('session-123');
```

## Transactions

```typescript
await db.transaction(async (client) => {
  await client.execute('INSERT INTO orders (id, user_id) VALUES ($1, $2)', ['order-1', 'user-1']);
  await client.execute('UPDATE inventory SET quantity = quantity - 1 WHERE product_id = $1', ['prod-1']);
  // If any query fails, all changes are rolled back
});
```

## With Agents

```typescript
import { Agent, createNeonPostgres, createPostgresSessionStorage } from 'praisonai';

const db = createNeonPostgres({ connectionString: process.env.DATABASE_URL });
const sessions = createPostgresSessionStorage(db);

const agent = new Agent({
  name: 'Persistent Assistant',
  instructions: 'You are a helpful assistant with memory.'
});

async function chat(sessionId: string, message: string) {
  // Load history
  const history = await sessions.getMessages(sessionId);
  
  // Build context
  const context = history.map(m => `${m.role}: ${m.content}`).join('\n');
  
  // Get response
  const response = await agent.chat(`${context}\nuser: ${message}`);
  
  // Save messages
  await sessions.addMessage(sessionId, {
    id: crypto.randomUUID(),
    role: 'user',
    content: message
  });
  
  await sessions.addMessage(sessionId, {
    id: crypto.randomUUID(),
    role: 'assistant',
    content: response
  });
  
  return response;
}
```

## Schema

The session storage creates these tables:

```sql
-- Sessions table
CREATE TABLE sessions (
  id TEXT PRIMARY KEY,
  data JSONB NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Messages table
CREATE TABLE sessions_messages (
  id TEXT PRIMARY KEY,
  session_id TEXT NOT NULL REFERENCES sessions(id),
  role TEXT NOT NULL,
  content TEXT NOT NULL,
  tool_calls JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Environment Variables

```bash
# Neon PostgreSQL
DATABASE_URL=postgres://user:pass@host/database?sslmode=require

# Or individual components
PGHOST=your-host.neon.tech
PGDATABASE=your-database
PGUSER=your-user
PGPASSWORD=your-password
```

## Related

- [Sessions](/docs/js/sessions) - Session management
- [Redis](/docs/js/redis) - Redis integration
- [Database](/docs/js/database) - Other database adapters
